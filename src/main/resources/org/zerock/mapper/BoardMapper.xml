<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD MyBatis Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="org.zerock.mapper.BoardMapper">

   <resultMap id="boardResultMap" type="org.zerock.dto.BoardDTO">
	    <result property="rteNm" column="rte_nm" />
	</resultMap>


    <!-- 게시글 등록 -->
<insert id="insert" parameterType="org.zerock.dto.BoardDTO">
    INSERT INTO board (name, title, content, email, rte_nm)
    VALUES (#{name}, #{title}, #{content}, #{email}, #{rteNm})
</insert>


    <!-- 게시글 목록 조회 (페이징 처리) -->
    <select id="selectList" resultType="org.zerock.dto.BoardDTO">
        SELECT *
        FROM board 
        ORDER BY bno DESC 
        LIMIT #{offset}, #{limit};
    </select>

    <!-- 게시글 상세 조회 -->
   <!-- 게시글 상세 조회 -->




   
	
	<select id="selectByBno" parameterType="Long" resultMap="boardResultMap">
	    SELECT *
	    FROM board
	    WHERE bno = #{bno}
	</select>
    


    <!-- 게시글 총 개수 조회 -->
    <select id="selectTotalCount" resultType="int">
        SELECT COUNT(*) FROM board
    </select>

    <!-- 게시글 상태 업데이트 -->
    <update id="updateStatus" parameterType="map">
        UPDATE board 
        SET status = #{status} 
        WHERE bno = #{bno};
    </update>

    <update id="updateStatusAndMemo">
        UPDATE board
        SET status = #{status}, memo = #{memo}
        WHERE bno = #{bno};
    </update>

      <!-- 버스 노선 목록 조회 -->
    <select id="selectAllBusnum" resultType="org.zerock.dto.BoardDTO">
        SELECT RTE_NM AS rteNm
        FROM busnum;
    </select>
    
    <select id="getBoardsByUserId" parameterType="String" resultType="org.zerock.dto.BoardDTO">
	   SELECT * FROM board WHERE email = #{email} ORDER BY regdate DESC;
	</select>
	
	<select id="mainList" resultType="org.zerock.dto.BoardDTO">
		 SELECT * FROM board ORDER BY regdate DESC;
	</select>
	
	<select id="sCount" resultType="java.util.Map">
		SELECT status, count(status) as count FROM board group by status 
		ORDER BY
			CASE 
				WHEN status = '미처리' THEN 1
				WHEN status = '처리중' THEN 2
				WHEN status = '완료' THEN 3
				ELSE 4  -- 다른 상태가 있을 경우 처리
			END;
	</select>


    <!-- 게시판 목록을 처리상태 기준으로 정렬 -->
    <select id="getBoardList" resultType="org.zerock.dto.BoardDTO">
        SELECT * FROM board
        ORDER BY 
            <choose>
                <when test="sort == 'status'">
                    status
                </when>
                <otherwise>
                    created_date
                </otherwise>
            </choose>
        <if test="order == 'asc'">ASC</if>
        <if test="order == 'desc'">DESC</if>
    </select>




</mapper>
